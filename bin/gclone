#!/usr/bin/env dash
set -eu

# [WIP] Git CLONE:
# Clone a repo based on url or repo name, automatically determine clone method (https with ssh fallback)

CACHE_FILE="$(dirname "$(dirname "$0")")/cache/$(basename "$0")"

if [ ! -f "$CACHE_FILE" ]; then
	mkdir -p "$(dirname "$CACHE_FILE")"

	# Optimistic
	print_user_and_orgs() {
		git config user.name # Assumes it's set correctly

		# Fetch the organizations the user is part of using gh CLI
		ORGS=$(gh api user/orgs --jq '.[].login')
		if [ -n "$ORGS" ]; then
			echo "$ORGS"
		fi
	}

	OUTPUT=$(print_user_and_orgs)
	echo "$OUTPUT" > "$CACHE_FILE"
fi
