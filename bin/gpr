#!/bin/sh

# Git PR
# Open existing or a new PR on GitHub.

# Determine default branch.
if git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
	default_branch=$(git rev-parse --abbrev-ref origin/HEAD)
	default_branch=${default_branch#"origin/"}
else
	echo "Error: gpr must be run in a Git repository."
	exit 1
fi

# Get origin URL and ensure it's in GitHub.
origin=$(git remote get-url origin)
case "$origin" in
	*github.com*)
		;;
	*)
		echo "Error: gpr requires origin url in GitHub."
		exit 1
		;;
esac

# Get current branch name.
branch=$(git rev-parse --abbrev-ref HEAD)

# If on default branch, simply open the repo
if [ "$branch" = "$default_branch" ]; then
	open "$origin"
	exit $?
fi

# Otherwise open the URL for creating a new PR or opening an existing one.
pr_url="$origin/pull/new/$branch"
open "$pr_url"
